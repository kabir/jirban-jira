<?xml version="1.0" encoding="UTF-8"?>

<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
  <plugin-info>
    <description>${project.description}</description>
    <version>${project.version}</version>
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    <param name="plugin-icon">images/pluginIcon.png</param>
    <param name="plugin-logo">images/pluginLogo.png</param>
  </plugin-info>
  <!-- add our i18n resource -->
  <resource type="i18n" name="i18n" location="jirban-jira"/>

  <!-- Loads up the index.html page -->
  <servlet name="Jirban Index Servlet" i18n-name-key="index-servlet.name" key="index-servlet" class="org.jirban.jira.servlet.IndexServlet">
    <description>The welcome servlet which redirects to the angular2 client</description>
    <url-pattern>/jirban</url-pattern>
  </servlet>

  <!-- Add a filter to load up the valid user -->
  <servlet-filter name="Jirban Auth Filter" i18n-name-key="auth-filter.name" key="auth-filter" class="org.jirban.jira.servlet.AuthFilter" location="before-dispatch" weight="100">
    <description>Filter authenticating requests.</description>
    <!--
      Need this since this is relative to the jira instance
      https://developer.atlassian.com/jiradev/jira-platform/guides/other/tutorial-writing-jira-event-listeners-with-the-atlassian-event-library
     -->
    <url-pattern>/plugins/servlet/jirban</url-pattern>
    <url-pattern>/rest/jirban/*</url-pattern>
  </servlet-filter>

  <!-- Add a filter to load up the valid user -->
  <servlet-filter name="Jirban Cache Header Filter" i18n-name-key="auth-filter.name" key="cache-header-filter" class="org.jirban.jira.servlet.CacheHeaderFilter" location="before-dispatch" weight="90">
    <description>Filter adding cache headers to the resource requests.</description>
    <!--
      Need this since this is relative to the jira instance
      https://developer.atlassian.com/jiradev/jira-platform/guides/other/tutorial-writing-jira-event-listeners-with-the-atlassian-event-library
     -->
    <url-pattern>/download/resources/org.jirban.jirban-jira/webapp</url-pattern>
    <url-pattern>/download/resources/org.jirban.jirban-jira/webapp/*</url-pattern>
  </servlet-filter>

  <!-- Add a filter to intercept the rank calls -->
  <servlet-filter name="Jirban Rank Filter" i18n-name-key="rank-filter.name" key="rank-filter" class="org.jirban.jira.servlet.RankIssueFilter" location="before-dispatch" weight="0">
    <description>Filter adding cache headers to the resource requests.</description>
    <!--
      Need this since this is relative to the jira instance
      https://developer.atlassian.com/jiradev/jira-platform/guides/other/tutorial-writing-jira-event-listeners-with-the-atlassian-event-library
     -->
    <url-pattern>/rest/greenhopper/1.0/rank</url-pattern>
    <url-pattern>/rest/greenhopper/1.0/api/rank/after</url-pattern>
    <url-pattern>/rest/greenhopper/1.0/api/rank/before</url-pattern>
    <url-pattern>/rest/greenhopper/1.0/rank/global/first</url-pattern>
    <url-pattern>/rest/greenhopper/1.0/rank/global/last</url-pattern>
  </servlet-filter>


  <resource type="download" name="webapp/" location="/webapp/"/>

  <!-- Active Objects configuration for configuration storage -->
  <ao name="Jirban Active Objects" key="ao-module">
    <description>The module configuring the Active Objects service used by this plugin</description>
    <entity>org.jirban.jira.impl.activeobjects.BoardCfg</entity>
    <entity>org.jirban.jira.impl.activeobjects.Setting</entity>
    <entity>org.jirban.jira.impl.activeobjects.UserAccess</entity>
  </ao>

  <web-item name="Jirban Agile Menu item" key="jirban-config" section="greenhopper_menu/greenhopper_menu_dropdown" weight="1000">
    <description>The Agile menu item taking you to the Jirban boards</description>
    <label>Jirban Boards</label>
    <link linkId="jirban-config-link">/plugins/servlet/jirban</link>
    <condition class="org.jirban.jira.api.IsLoggedInCondition"/>
  </web-item>


  <rest name="Jirban Rest" key="jirban-rest" path="/jirban" version="1.0">
    <description>The REST API handling the requests from the angular2 client.</description>
  </rest>

</atlassian-plugin>
